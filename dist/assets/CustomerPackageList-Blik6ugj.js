import{g as s,I as X,i as x,m as Z,z as K,o as ee,u as te,n as w,v as f,r as u,w as a,f as _,h as l,t as d,d as h,s as H,e as O,F as N,A as B,q as y}from"./index-LmRE4l5i.js";import{a as ae}from"./customer-1Roj4YCo.js";import{g as ne,u as ie,c as se}from"./purchaseHistory-Bpe0Y95q.js";var le={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"}}]},name:"shopping-cart",theme:"outlined"};function j(v){for(var p=1;p<arguments.length;p++){var i=arguments[p]!=null?Object(arguments[p]):{},c=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(i).filter(function(m){return Object.getOwnPropertyDescriptor(i,m).enumerable}))),c.forEach(function(m){oe(v,m,i[m])})}return v}function oe(v,p,i){return p in v?Object.defineProperty(v,p,{value:i,enumerable:!0,configurable:!0,writable:!0}):v[p]=i,v}var D=function(p,i){var c=j({},p,i.attrs);return s(X,j({},c,{icon:le}),null)};D.displayName="ShoppingCartOutlined";D.inheritAttrs=!1;const re={style:{"margin-top":"32px"}},ue={key:2},de={style:{"margin-bottom":"12px"}},pe={key:0,style:{"margin-bottom":"24px",padding:"12px",background:"#f0f2f5","border-radius":"6px"}},ve={__name:"CustomerPackageList",setup(v){const p=te(),i=x(null),c=x(!1),m=x(!1),o=x({years:1,product_name:"G√≥i Premium",is_active:!0,is_paid:!1}),k=x([]),g=Z(()=>k.value.find(t=>t.is_active==1&&t.is_paid==1&&K(t.expires_at).isAfter(K()))),L=[{title:"T√™n g√≥i",key:"product_name",dataIndex:"product_name"},{title:"S·ªë l∆∞·ª£ng",key:"quantity",dataIndex:"quantity"},{title:"Ng√†y mua",key:"purchased_at",dataIndex:"purchased_at"},{title:"B·∫Øt ƒë·∫ßu",key:"starts_at",dataIndex:"starts_at"},{title:"K·∫øt th√∫c",key:"expires_at",dataIndex:"expires_at"},{title:"Thanh to√°n",key:"is_paid",dataIndex:"is_paid"},{title:"Tr·∫°ng th√°i",key:"is_active",dataIndex:"is_active"}];ee(async()=>{try{const t=await ae(p.params.id);i.value=t.data,k.value=t.data.packages||[]}catch(t){console.error("Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng",t)}});const S=async t=>{o.value={years:1,product_name:"G√≥i Premium",is_active:!0,is_paid:!1},m.value=!1,c.value=!0;try{const e=await ne({customer_id:t.id});k.value=e.data.data||[]}catch{y.error("Kh√¥ng t·∫£i ƒë∆∞·ª£c l·ªãch s·ª≠ g√≥i")}},q=t=>{o.value={years:1,product_name:t.product_name,is_active:t.is_active==1,is_paid:t.is_paid==1},m.value=!0,c.value=!0},F=async()=>{if(g.value){y.warning("Kh√°ch h√†ng ƒëang c√≥ g√≥i ho·∫°t ƒë·ªông. Kh√¥ng th·ªÉ ƒëƒÉng k√Ω m·ªõi.");return}try{const t=new Date,e=o.value.years||1,I={customer_id:i.value.id,product_name:o.value.product_name,quantity:e,is_active:o.value.is_active?1:0,is_paid:o.value.is_paid?1:0,starts_at:t.toISOString(),expires_at:new Date(t.setFullYear(t.getFullYear()+e)).toISOString()};await se(I),y.success("ƒêƒÉng k√Ω g√≥i th√†nh c√¥ng"),await S(i.value),i.value.packages=[...k.value],c.value=!1}catch{y.error("L·ªói khi ƒëƒÉng k√Ω g√≥i")}},M=async()=>{try{const e={extend_years:o.value.years||1,is_paid:o.value.is_paid?1:0,is_active:o.value.is_active?1:0};await ie(g.value.id,e),y.success("Gia h·∫°n g√≥i th√†nh c√¥ng"),await S(i.value),i.value.packages=[...k.value],c.value=!1}catch{y.error("L·ªói khi gia h·∫°n g√≥i")}};function T(t){return t?new Date(t)<new Date:!1}return(t,e)=>{var z,E;const I=u("a-page-header"),C=u("a-descriptions-item"),U=u("a-descriptions"),G=u("a-button"),V=u("a-space"),b=u("a-tag"),A=u("a-table"),R=u("a-select-option"),Y=u("a-select"),P=u("a-form-item"),J=u("a-input-number"),$=u("a-checkbox"),Q=u("a-form"),W=u("a-drawer");return _(),w("div",null,[s(I,{title:`Kh√°ch h√†ng: ${((z=i.value)==null?void 0:z.name)||""}`,onBack:e[0]||(e[0]=n=>t.$router.back()),style:{"padding-left":"0"}},null,8,["title"]),s(U,{bordered:"",column:1,size:"small",style:{"margin-top":"16px"}},{default:a(()=>[s(C,{label:"Email"},{default:a(()=>{var n;return[l(d((n=i.value)==null?void 0:n.email),1)]}),_:1}),s(C,{label:"S·ªë ƒëi·ªán tho·∫°i"},{default:a(()=>{var n;return[l(d((n=i.value)==null?void 0:n.phone),1)]}),_:1}),s(C,{label:"ƒê·ªãa ch·ªâ"},{default:a(()=>{var n;return[l(d((n=i.value)==null?void 0:n.address),1)]}),_:1}),s(C,{label:"T·ªânh / Th√†nh"},{default:a(()=>{var n;return[l(d((n=i.value)==null?void 0:n.city),1)]}),_:1})]),_:1}),f("div",re,[s(V,{style:{"margin-bottom":"16px"}},{default:a(()=>[s(G,{type:"primary",onClick:e[1]||(e[1]=n=>S(i.value))},{icon:a(()=>[s(O(D))]),default:a(()=>[e[9]||(e[9]=l(" Mua th√™m g√≥i "))]),_:1}),g.value?(_(),h(G,{key:0,type:"default",onClick:e[2]||(e[2]=n=>q(g.value))},{default:a(()=>e[10]||(e[10]=[l("Gia h·∫°n g√≥i")])),_:1})):H("",!0)]),_:1}),s(A,{columns:L,"data-source":((E=i.value)==null?void 0:E.packages)||[],pagination:!1,"row-key":"id",bordered:"",size:"small"},{bodyCell:a(({column:n,record:r})=>[n.key==="is_paid"?(_(),h(b,{key:0,color:r.is_paid==="1"?"green":"red"},{default:a(()=>[l(d(r.is_paid==="1"?"ƒê√£ thanh to√°n":"Ch∆∞a thanh to√°n"),1)]),_:2},1032,["color"])):n.key==="is_active"?(_(),w(N,{key:1},[r.is_paid==="0"?(_(),h(b,{key:0,color:"default"},{default:a(()=>e[11]||(e[11]=[l("Ch∆∞a k√≠ch ho·∫°t")])),_:1})):T(r.expires_at)?(_(),h(b,{key:1,color:"red"},{default:a(()=>e[12]||(e[12]=[l("ƒê√£ h·∫øt h·∫°n")])),_:1})):(_(),h(b,{key:2,color:"blue"},{default:a(()=>e[13]||(e[13]=[l("ƒê√£ k√≠ch ho·∫°t")])),_:1}))],64)):["purchased_at","starts_at","expires_at"].includes(n.key)?(_(),w("span",ue,[l(d(O(B)(r[n.key]))+" ",1),n.key==="expires_at"&&T(r.expires_at)?(_(),h(b,{key:0,color:"red",style:{"margin-left":"8px"}},{default:a(()=>e[14]||(e[14]=[l(" H·∫øt h·∫°n ")])),_:1})):H("",!0)])):(_(),w(N,{key:3},[l(d(r[n.key]),1)],64))]),_:1},8,["data-source"])]),s(W,{open:c.value,title:m.value?"Gia h·∫°n g√≥i hi·ªán t·∫°i":"ƒêƒÉng k√Ω g√≥i m·ªõi",onClose:e[8]||(e[8]=n=>c.value=!1),width:"500"},{default:a(()=>{var n;return[f("div",de,[e[15]||(e[15]=f("strong",null,"Kh√°ch h√†ng:",-1)),l(" "+d((n=i.value)==null?void 0:n.name),1)]),g.value?(_(),w("div",pe,[e[16]||(e[16]=f("h4",null,"üéØ G√≥i hi·ªán t·∫°i ƒëang d√πng:",-1)),f("p",null,[f("strong",null,d(g.value.product_name),1)]),f("p",null,"B·∫Øt ƒë·∫ßu: "+d(O(B)(g.value.starts_at)),1),f("p",null,"H·∫øt h·∫°n: "+d(O(B)(g.value.expires_at)),1),f("p",null,"Thanh to√°n: "+d(g.value.is_paid?"ƒê√£ thanh to√°n":"Ch∆∞a thanh to√°n"),1)])):H("",!0),s(Q,{layout:"vertical"},{default:a(()=>[s(P,{label:"G√≥i ƒëƒÉng k√Ω"},{default:a(()=>[s(Y,{value:o.value.product_name,"onUpdate:value":e[3]||(e[3]=r=>o.value.product_name=r)},{default:a(()=>[s(R,{value:"G√≥i Premium"},{default:a(()=>e[17]||(e[17]=[l("G√≥i Premium")])),_:1})]),_:1},8,["value"])]),_:1}),s(P,{label:"Th·ªùi h·∫°n g√≥i (nƒÉm)"},{default:a(()=>[s(J,{value:o.value.years,"onUpdate:value":e[4]||(e[4]=r=>o.value.years=r),min:1,max:5},null,8,["value"])]),_:1}),s(P,null,{default:a(()=>[s($,{checked:o.value.is_active,"onUpdate:checked":e[5]||(e[5]=r=>o.value.is_active=r)},{default:a(()=>e[18]||(e[18]=[l("K√≠ch ho·∫°t ngay")])),_:1},8,["checked"])]),_:1}),s(P,null,{default:a(()=>[s($,{checked:o.value.is_paid,"onUpdate:checked":e[6]||(e[6]=r=>o.value.is_paid=r)},{default:a(()=>e[19]||(e[19]=[l("ƒê√£ thanh to√°n")])),_:1},8,["checked"])]),_:1}),s(G,{type:"primary",block:"",onClick:e[7]||(e[7]=r=>m.value?M():F())},{default:a(()=>[l(d(m.value?"Gia h·∫°n g√≥i":"ƒêƒÉng k√Ω g√≥i m·ªõi"),1)]),_:1})]),_:1})]}),_:1},8,["open","title"])])}}};export{ve as default};
