import{i as h,m as me,z as U,n as w,g as a,v as ve,r,w as l,q as b,b as _e,f as i,h as p,e as S,P as ce,d as g,F as E,s as C,t as x,A as K,E as he,D as ge,B as fe}from"./index-LmRE4l5i.js";import{g as ke,d as ye,u as we,c as be}from"./customer-1Roj4YCo.js";const Ce={style:{"margin-bottom":"12px",display:"flex","justify-content":"flex-end"}},xe=["src"],Te={key:5},Ne={__name:"CustomerList",setup(Ue){const O=_e(),P=h([]),R=h(!1),D=h(!1),m=h(!1),n=h({years:1,product_name:"G√≥i Premium",is_active:!0,is_paid:!1}),j=h(),f=h(!1);h(!1);const o=h({name:"",phone:"",email:"",city:"",dateRange:[]}),k=h({current:1,pageSize:10,total:0}),X=h([]);me(()=>X.value.find(t=>t.is_active===1&&t.is_paid===1&&U(t.expires_at).isAfter(U(),"day")));const q=[{title:"STT",key:"stt"},{title:"T√™n kh√°ch h√†ng",key:"name",dataIndex:"name"},{title:"S·ªë ƒëi·ªán tho·∫°i",key:"phone",dataIndex:"phone"},{title:"Email",key:"email",dataIndex:"email"},{title:"ƒê·ªãa ch·ªâ",key:"address",dataIndex:"address"},{title:"T·ªânh th√†nh",key:"city",dataIndex:"city"},{title:"Tr·∫°ng th√°i KH",key:"customer_status",dataIndex:"customer_status_text"},{title:"Thao t√°c",key:"action"}],y={name:[{required:!0,message:"Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng",trigger:"blur"}],phone:[{validator:(t,e)=>e?/^(0|\+84)[0-9]{9,10}$/.test(e)?Promise.resolve():Promise.reject("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá"):Promise.reject("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"),trigger:"blur"}],email:[{type:"email",message:"Email kh√¥ng h·ª£p l·ªá",trigger:"blur"}],customer_status:[{required:!0,message:"Vui l√≤ng ch·ªçn tr·∫°ng th√°i kh√°ch h√†ng",trigger:"change"}],password:[{validator:(t,e)=>(!m.value||f.value)&&!e?Promise.reject("Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u"):e&&e.length<6?Promise.reject("M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±"):Promise.resolve(),trigger:"blur"}],confirm_password:[{validator:(t,e)=>(!m.value||f.value)&&n.value.password&&e!==n.value.password?Promise.reject("M·∫≠t kh·∫©u kh√¥ng kh·ªõp"):Promise.resolve(),trigger:"blur"}]},L=t=>{O.push(`/customers/${t.id}`)},N=async()=>{R.value=!0;try{const t={page:k.value.current,per_page:k.value.pageSize,search:o.value.name,phone:o.value.phone,email:o.value.email,city:o.value.city,from:o.value.dateRange[0]?U(o.value.dateRange[0]).format("YYYY-MM-DD"):void 0,to:o.value.dateRange[1]?U(o.value.dateRange[1]).format("YYYY-MM-DD"):void 0},e=await ke(t);P.value=e.data.data.map(c=>{var v;const u=((v=c.packages)==null?void 0:v[0])??null;return{...c,packages:Array.isArray(c.packages)?c.packages:[],status:Number(c.status),customer_status_text:ee(Number(c.status)),customer_status:Number(c.status),package_start_date:(u==null?void 0:u.starts_at)??null,package_end_date:(u==null?void 0:u.expires_at)??null,payment_status:(u==null?void 0:u.is_paid)==="1"?"paid":"unpaid",note:(u==null?void 0:u.note)??""}}),k.value.total=e.data.pager.total}catch{b.error("Kh√¥ng th·ªÉ t·∫£i danh s√°ch kh√°ch h√†ng")}finally{R.value=!1}};function z(t){return t?new Date(t)<new Date:!0}function B(t){return t.payment_status==="paid"&&!z(t.package_end_date)?"ƒêang ho·∫°t ƒë·ªông":"Ng·ª´ng ho·∫°t ƒë·ªông"}const F=()=>{m.value=!1,n.value={name:"",email:"",phone:"",city:"",address:"",customer_status:2,password:"",confirm_password:""},D.value=!0},G=t=>{m.value=!0;let e;if(t.package_start_date&&t.package_end_date){const c=U(t.package_start_date),v=U(t.package_end_date).diff(c,"year");e=v>0?v:void 0}Number(t.status),console.log("üü¶ record.status =",t.status,"| typeof =",typeof t.status),n.value={id:t.id,name:t.name,email:t.email,phone:t.phone,city:t.city,address:t.address,customer_status:Number(t.status),package_duration_years:e},f.value=!1,D.value=!0},Q=()=>{D.value=!1},J=()=>{j.value.validate().then(W).catch(()=>{b.warning("Vui l√≤ng ki·ªÉm tra l·∫°i c√°c tr∆∞·ªùng b·∫Øt bu·ªôc")})},W=async()=>{try{if(m.value){const t={name:n.value.name,email:n.value.email,phone:n.value.phone,city:n.value.city,address:n.value.address,status:n.value.customer_status};f.value&&(n.value.password&&(t.password=n.value.password),n.value.confirm_password&&(t.confirm_password=n.value.confirm_password)),await we(n.value.id,t),b.success("C·∫≠p nh·∫≠t th√†nh c√¥ng")}else{const t={name:n.value.name,email:n.value.email,phone:n.value.phone,city:n.value.city,address:n.value.address,status:n.value.customer_status,password:n.value.password,confirm_password:n.value.confirm_password};await be(t),b.success("Th√™m th√†nh c√¥ng")}D.value=!1,await N()}catch(t){console.error(t),b.error("L·ªói khi l∆∞u th√¥ng tin kh√°ch h√†ng")}},Z=async t=>{try{await ye(t),b.success("ƒê√£ xo√° kh√°ch h√†ng"),await N()}catch{b.error("Kh√¥ng th·ªÉ xo√° kh√°ch h√†ng")}},ee=t=>{switch(parseInt(t)){case 0:return"M·ªõi";case 1:return"ƒêang ho·∫°t ƒë·ªông";case 2:return"Ng·ª´ng ho·∫°t ƒë·ªông";case 3:return"VIP";case 4:return"H·∫øt h·∫°n";default:return"Kh√¥ng r√µ"}},ae=t=>{k.value.current=t.current,k.value.pageSize=t.pageSize,N()};return N(),(t,e)=>{const c=r("a-page-header"),u=r("a-input"),v=r("a-col"),te=r("a-range-picker"),T=r("a-button"),ne=r("a-row"),I=r("a-tag"),M=r("a-tooltip"),le=r("a-popconfirm"),se=r("a-space"),ue=r("a-table"),_=r("a-form-item"),Y=r("a-select-option"),oe=r("a-select"),V=r("a-input-password"),re=r("a-checkbox"),ie=r("a-form"),de=r("a-drawer");return i(),w("div",null,[a(c,{title:"Qu·∫£n l√Ω kh√°ch h√†ng",style:{"padding-left":"0"}}),a(ne,{gutter:[16,16],style:{"margin-bottom":"16px"}},{default:l(()=>[a(v,{span:4},{default:l(()=>[a(u,{value:o.value.name,"onUpdate:value":e[0]||(e[0]=s=>o.value.name=s),placeholder:"T√™n kh√°ch h√†ng"},null,8,["value"])]),_:1}),a(v,{span:4},{default:l(()=>[a(u,{value:o.value.phone,"onUpdate:value":e[1]||(e[1]=s=>o.value.phone=s),placeholder:"S·ªë ƒëi·ªán tho·∫°i"},null,8,["value"])]),_:1}),a(v,{span:4},{default:l(()=>[a(u,{value:o.value.email,"onUpdate:value":e[2]||(e[2]=s=>o.value.email=s),placeholder:"Email"},null,8,["value"])]),_:1}),a(v,{span:4},{default:l(()=>[a(u,{value:o.value.city,"onUpdate:value":e[3]||(e[3]=s=>o.value.city=s),placeholder:"T·ªânh/TP"},null,8,["value"])]),_:1}),a(v,{span:6},{default:l(()=>[a(te,{value:o.value.dateRange,"onUpdate:value":e[4]||(e[4]=s=>o.value.dateRange=s),style:{width:"100%"}},null,8,["value"])]),_:1}),a(v,{span:2},{default:l(()=>[a(T,{type:"primary",block:"",onClick:N},{default:l(()=>e[16]||(e[16]=[p("T√¨m ki·∫øm")])),_:1})]),_:1})]),_:1}),ve("div",Ce,[a(T,{type:"primary",onClick:F},{icon:l(()=>[a(S(ce))]),default:l(()=>[e[17]||(e[17]=p(" Th√™m kh√°ch h√†ng "))]),_:1})]),a(ue,{columns:q,"data-source":P.value,loading:R.value,"row-key":"id",pagination:k.value,onChange:ae},{bodyCell:l(({column:s,record:d,index:pe})=>{var $,A;return[s.key==="avatar"?(i(),w(E,{key:0},[d&&d.avatar?(i(),w("img",{key:0,src:d.avatar},null,8,xe)):C("",!0)],64)):s.key==="stt"?(i(),w(E,{key:1},[p(x((((($=k.value)==null?void 0:$.current)||1)-1)*(((A=k.value)==null?void 0:A.pageSize)||10)+pe+1),1)],64)):s.key==="customer_status"?(i(),g(I,{key:2,color:B(d)==="ƒêang ho·∫°t ƒë·ªông"?"blue":"default"},{default:l(()=>[p(x(B(d)),1)]),_:2},1032,["color"])):s.key==="payment_status"?(i(),g(I,{key:3,color:d.payment_status==="paid"?"green":"orange"},{default:l(()=>[p(x(d.payment_status==="paid"?"ƒê√£ thanh to√°n":"Ch∆∞a thanh to√°n"),1)]),_:2},1032,["color"])):s.key==="package_start_date"?(i(),w(E,{key:4},[p(x(d.package_start_date?S(K)(d.package_start_date):"‚Äî"),1)],64)):s.key==="package_end_date"?(i(),w("span",Te,[p(x(S(K)(d.package_end_date))+" ",1),z(d.package_end_date)?(i(),g(I,{key:0,color:"red",style:{"margin-left":"8px"}},{default:l(()=>e[18]||(e[18]=[p(" H·∫øt h·∫°n ")])),_:1})):C("",!0)])):s.key==="action"?(i(),g(se,{key:6},{default:l(()=>[a(M,{title:"S·ª≠a kh√°ch h√†ng"},{default:l(()=>[a(T,{type:"text",onClick:H=>G(d)},{icon:l(()=>[a(S(he))]),_:2},1032,["onClick"])]),_:2},1024),a(le,{title:"B·∫°n c√≥ ch·∫Øc mu·ªën xo√°?",onConfirm:H=>Z(d.id)},{default:l(()=>[a(M,{title:"Xo√°"},{default:l(()=>[a(T,{type:"text",danger:""},{icon:l(()=>[a(S(ge))]),_:1})]),_:1})]),_:2},1032,["onConfirm"]),a(M,{title:"Xem chi ti·∫øt"},{default:l(()=>[a(T,{type:"text",onClick:H=>L(d)},{icon:l(()=>[a(S(fe))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):(i(),w(E,{key:7},[p(x(d[s.key]),1)],64))]}),_:1},8,["data-source","loading","pagination"]),a(de,{open:D.value,title:m.value?"S·ª≠a kh√°ch h√†ng":"Th√™m kh√°ch h√†ng",onClose:Q,width:"500"},{default:l(()=>[a(ie,{ref_key:"formRef",ref:j,layout:"vertical",model:n.value},{default:l(()=>[a(_,{label:"T√™n kh√°ch h√†ng",name:"name",rules:y.name},{default:l(()=>[a(u,{value:n.value.name,"onUpdate:value":e[5]||(e[5]=s=>n.value.name=s)},null,8,["value"])]),_:1},8,["rules"]),a(_,{label:"Email",name:"email",rules:y.email},{default:l(()=>[a(u,{value:n.value.email,"onUpdate:value":e[6]||(e[6]=s=>n.value.email=s)},null,8,["value"])]),_:1},8,["rules"]),a(_,{label:"S·ªë ƒëi·ªán tho·∫°i",name:"phone",rules:y.phone},{default:l(()=>[a(u,{value:n.value.phone,"onUpdate:value":e[7]||(e[7]=s=>n.value.phone=s)},null,8,["value"])]),_:1},8,["rules"]),a(_,{label:"T·ªânh / Th√†nh ph·ªë"},{default:l(()=>[a(u,{value:n.value.city,"onUpdate:value":e[8]||(e[8]=s=>n.value.city=s)},null,8,["value"])]),_:1}),a(_,{label:"ƒê·ªãa ch·ªâ"},{default:l(()=>[a(u,{value:n.value.address,"onUpdate:value":e[9]||(e[9]=s=>n.value.address=s)},null,8,["value"])]),_:1}),a(_,{label:"Tr·∫°ng th√°i",name:"customer_status",rules:y.customer_status},{default:l(()=>[a(oe,{value:n.value.customer_status,"onUpdate:value":e[10]||(e[10]=s=>n.value.customer_status=s),placeholder:"Ch·ªçn tr·∫°ng th√°i"},{default:l(()=>[a(Y,{value:1},{default:l(()=>e[19]||(e[19]=[p("ƒêang ho·∫°t ƒë·ªông")])),_:1}),a(Y,{value:2},{default:l(()=>e[20]||(e[20]=[p("Ng·ª´ng ho·∫°t ƒë·ªông")])),_:1}),a(Y,{value:3},{default:l(()=>e[21]||(e[21]=[p("VIP")])),_:1})]),_:1},8,["value"])]),_:1},8,["rules"]),m.value?C("",!0):(i(),g(_,{key:0,label:"M·∫≠t kh·∫©u",name:"password",rules:y.password},{default:l(()=>[a(V,{value:n.value.password,"onUpdate:value":e[11]||(e[11]=s=>n.value.password=s)},null,8,["value"])]),_:1},8,["rules"])),m.value?C("",!0):(i(),g(_,{key:1,label:"X√°c nh·∫≠n m·∫≠t kh·∫©u",name:"confirm_password",rules:y.confirm_password},{default:l(()=>[a(V,{value:n.value.confirm_password,"onUpdate:value":e[12]||(e[12]=s=>n.value.confirm_password=s)},null,8,["value"])]),_:1},8,["rules"])),m.value?(i(),g(_,{key:2},{default:l(()=>[a(re,{checked:f.value,"onUpdate:checked":e[13]||(e[13]=s=>f.value=s)},{default:l(()=>e[22]||(e[22]=[p("ƒê·ªïi m·∫≠t kh·∫©u")])),_:1},8,["checked"])]),_:1})):C("",!0),m.value&&f.value?(i(),g(_,{key:3,label:"M·∫≠t kh·∫©u m·ªõi",name:"password",rules:y.password},{default:l(()=>[a(V,{value:n.value.password,"onUpdate:value":e[14]||(e[14]=s=>n.value.password=s)},null,8,["value"])]),_:1},8,["rules"])):C("",!0),m.value&&f.value?(i(),g(_,{key:4,label:"X√°c nh·∫≠n m·∫≠t kh·∫©u",name:"confirm_password",rules:y.confirm_password},{default:l(()=>[a(V,{value:n.value.confirm_password,"onUpdate:value":e[15]||(e[15]=s=>n.value.confirm_password=s)},null,8,["value"])]),_:1},8,["rules"])):C("",!0),a(_,null,{default:l(()=>[a(T,{type:"primary",block:"",onClick:J},{default:l(()=>[p(x(m.value?"C·∫≠p nh·∫≠t":"T·∫°o m·ªõi"),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}};export{Ne as default};
