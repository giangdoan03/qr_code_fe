import{i as _,m as H,o as N,n as v,g,w as s,r as i,p as L,q as k,f as r,h as c,t as p,d as y,s as P,F as x,v as R,e as X,x as $,y as E}from"./index-qam7hN02.js";const F={class:"truncate block max-w-[150px]"},Q={__name:"ScanHistoryList",setup(U){const b=_([]),u=_(!1),h=_(""),o=_({current:1,pageSize:10,total:0}),w=[{title:"STT",key:"stt",width:60,align:"center"},{title:"Ảnh đối tượng",key:"object_image",dataIndex:"object_image"},{title:"Tên QR Code",key:"qr_name",dataIndex:"qr_name",ellipsis:!0},{title:"Tên đối tượng",key:"object_name",dataIndex:"object_name",ellipsis:!0},{title:"Loại đối tượng",key:"type",dataIndex:"type"},{title:"Tỉnh thành",key:"city",dataIndex:"city"},{title:"Vị trí",key:"location",dataIndex:"location"},{title:"IP",key:"ip",dataIndex:"ip"},{title:"Hệ điều hành",key:"os",dataIndex:"os"},{title:"Ứng dụng",key:"app",dataIndex:"app"},{title:"Thời gian",key:"created_at",dataIndex:"created_at"}],n=_([]),S=H(()=>({selectedRowKeys:n.value,onChange:t=>{n.value=t}})),C=t=>({product:"blue",store:"purple",event:"green",person:"volcano",business:"gold"})[t]||"default",T=t=>({product:"Sản phẩm",store:"Cửa hàng",event:"Sự kiện",person:"Cá nhân",business:"Doanh nghiệp"})[t]||t,j=async()=>{if(!(!n.value.length||!window.confirm(`Xoá ${n.value.length} bản ghi?`))){u.value=!0;try{await Promise.all(n.value.map(e=>E(e))),k.success(`Đã xoá ${n.value.length} bản ghi`),n.value=[],d()}catch{k.error("Xoá thất bại")}finally{u.value=!1}}},d=async()=>{u.value=!0;try{const t=await L({search:h.value,page:o.value.current,per_page:o.value.pageSize});b.value=t.data.data.map(e=>({...e,object_name:e.object_name||"",object_image:e.object_image||"",qr_name:e.qr_name||"",qr_type:e.qr_type||"",phone:e.phone_number||"",ip:e.ip_address||"",app:e.app||e.browser||"Không xác định",customer:e.user_id?`User #${e.user_id}`:"",location:e.city||""})),o.value.total=t.data.pager.total}catch{k.error("Không thể tải dữ liệu")}finally{u.value=!1}},I=t=>{o.value.current=t.current,o.value.pageSize=t.pageSize,d()};return N(d),(t,e)=>{const q=i("a-input"),f=i("a-button"),z=i("a-space"),K=i("a-image"),m=i("a-tag"),V=i("a-tooltip"),B=i("a-table");return r(),v("div",null,[g(z,{style:{"margin-bottom":"16px"}},{default:s(()=>[g(q,{value:h.value,"onUpdate:value":e[0]||(e[0]=a=>h.value=a),placeholder:"Tìm theo loại, tỉnh...",onPressEnter:d},null,8,["value"]),g(f,{type:"primary",onClick:d},{default:s(()=>e[1]||(e[1]=[c("Tìm kiếm")])),_:1}),g(f,{danger:"",onClick:j,disabled:!n.value.length},{default:s(()=>[c(" Xoá đã chọn ("+p(n.value.length)+") ",1)]),_:1},8,["disabled"])]),_:1}),g(B,{columns:w,"data-source":b.value,pagination:o.value,"row-key":"id",loading:u.value,onChange:I,"row-selection":S.value},{bodyCell:s(({column:a,record:l,index:D})=>[a.key==="stt"?(r(),v(x,{key:0},[c(p((o.value.current-1)*o.value.pageSize+D+1),1)],64)):a.key==="object_image"?(r(),y(K,{key:1,src:l.object_image||"https://placehold.co/100x100",width:100,height:80,preview:!0,fallback:"https://placehold.co/100x100",alt:"Ảnh",style:{"object-fit":"cover"}},null,8,["src"])):a.key==="type"?(r(),y(m,{key:2,color:C(l.type)},{default:s(()=>[c(p(T(l.type)),1)]),_:2},1032,["color"])):a.key==="qr_name"||a.key==="object_name"?(r(),y(V,{key:3,title:l[a.key]},{default:s(()=>[R("span",F,p(l[a.key]),1)]),_:2},1032,["title"])):a.key==="os"?(r(),y(m,{key:4},{default:s(()=>[c(p(l.os),1)]),_:2},1024)):a.key==="app"?(r(),y(m,{key:5,color:"blue"},{default:s(()=>[c(p(l.app||"Không xác định"),1)]),_:2},1024)):a.key==="created_at"?(r(),v(x,{key:6},[c(p(X($)(l.created_at)),1)],64)):P("",!0)]),_:1},8,["data-source","pagination","loading","row-selection"])])}}};export{Q as default};
