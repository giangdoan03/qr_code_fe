import{g as t,I as re,a as de,i as f,C as ce,G as ve,o as pe,H as fe,q as g,n as b,r as u,w as n,J as me,f as d,d as y,s as w,h as k,t as j,v as ge,e as A,U as _e,F as ye,z as D,K as ke,L as he,M as be}from"./index-Db9tVYel.js";var we={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M716.3 313.8c19-18.9 19-49.7 0-68.6l-69.9-69.9.1.1c-18.5-18.5-50.3-50.3-95.3-95.2-21.2-20.7-55.5-20.5-76.5.5L80.9 474.2a53.84 53.84 0 000 76.4L474.6 944a54.14 54.14 0 0076.5 0l165.1-165c19-18.9 19-49.7 0-68.6a48.7 48.7 0 00-68.7 0l-125 125.2c-5.2 5.2-13.3 5.2-18.5 0L189.5 521.4c-5.2-5.2-5.2-13.3 0-18.5l314.4-314.2c.4-.4.9-.7 1.3-1.1 5.2-4.1 12.4-3.7 17.2 1.1l125.2 125.1c19 19 49.8 19 68.7 0zM408.6 514.4a106.3 106.2 0 10212.6 0 106.3 106.2 0 10-212.6 0zm536.2-38.6L821.9 353.5c-19-18.9-49.8-18.9-68.7.1a48.4 48.4 0 000 68.6l83 82.9c5.2 5.2 5.2 13.3 0 18.5l-81.8 81.7a48.4 48.4 0 000 68.6 48.7 48.7 0 0068.7 0l121.8-121.7a53.93 53.93 0 00-.1-76.4z"}}]},name:"ant-design",theme:"outlined"};function K(i){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?Object(arguments[s]):{},v=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(a).filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable}))),v.forEach(function(r){xe(i,r,a[r])})}return i}function xe(i,s,a){return s in i?Object.defineProperty(i,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[s]=a,i}var I=function(s,a){var v=K({},s,a.attrs);return t(re,K({},v,{icon:we}),null)};I.displayName="AntDesignOutlined";I.inheritAttrs=!1;const U=de.create({baseURL:"https://api.goldenwin.vn/api",withCredentials:!0}),Ue=()=>U.get("/setting"),Se=i=>U.post("/setting",i),Ce=(i,s)=>U.put(`/setting/${i}`,s),Oe=i=>U.delete(`/setting/${i}`),Le={key:0},Ie={key:0},Pe={key:1},Ve={__name:"SettingList",setup(i){const s=f("userInfo");ce();const a=f({}),v=f(!1),r=ve({current:"",new:"",confirm:""}),P=f([]),S=f(!1),p=f({id:null,key:"",value:""}),B=f(!0),F=f(""),z=f(!1),$=f(""),E=[{title:"Key",dataIndex:"key",key:"key"},{title:"Value",dataIndex:"value",key:"value"},{title:"Hành động",key:"action"}];pe(async()=>{try{const o=await fe();a.value=o.data,a.value.avatar&&(h.value=[{uid:"-1",name:"avatar",status:"done",url:a.value.avatar}])}catch{g.error("Không thể tải thông tin người dùng")}await C()});const h=f([]),H=async(o,e)=>{const{data:m}=await ke(e);return a.value.avatar=m.url,h.value=[{uid:Date.now(),name:e.name,status:"done",url:m.url}],!1},X=(o,e)=>{a.value.avatar=null,h.value=[]},R=o=>{F.value=o.url||o.thumbUrl,z.value=!0,$.value=o.name||""},C=async()=>{S.value=!0;try{const o=await Ue();P.value=o.data}catch{g.error("Không thể tải cài đặt")}finally{S.value=!1}},N=o=>{if(!o)return null;const e=D(),_=D(o).diff(e,"day");return _>=0?_:0},q=o=>{p.value={...o}},G=async o=>{try{await Oe(o),g.success("Đã xoá"),await C()}catch{g.error("Lỗi khi xoá")}},J=async()=>{var o,e;try{if(await he(a.value.id,{name:a.value.name,phone:a.value.phone,status:a.value.status,avatar:a.value.avatar}),v.value){if(r.new!==r.confirm)return g.error("Mật khẩu mới không khớp");await be({current_password:r.current,new_password:r.new}),g.success("Đã đổi mật khẩu thành công")}p.value.key&&p.value.value&&(p.value.id?(await Ce(p.value.id,p.value),g.success("Đã cập nhật cài đặt")):(await Se(p.value),g.success("Đã thêm cài đặt")),p.value={id:null,key:"",value:""},await C()),g.success("Đã lưu toàn bộ thông tin")}catch(m){console.error("Lỗi khi lưu:",m),g.error(((e=(o=m==null?void 0:m.response)==null?void 0:o.data)==null?void 0:e.message)||"Lỗi khi lưu dữ liệu")}};return(o,e)=>{const m=u("a-page-header"),_=u("a-input"),c=u("a-form-item"),x=u("a-tag"),Q=u("a-checkbox"),O=u("a-input-password"),W=u("a-upload"),Y=u("a-image"),Z=u("a-avatar"),ee=u("a-card"),te=u("a-col"),ae=u("a-row"),V=u("a-tab-pane"),L=u("a-button"),ne=u("a-popconfirm"),le=u("a-space"),oe=u("a-table"),ue=u("a-divider"),M=u("a-form"),ie=u("a-tabs");return d(),b("div",null,[t(m,{title:"Thông tin người dùng & Cài đặt",class:"header-title"}),t(M,{layout:"vertical",onSubmit:e[11]||(e[11]=me(()=>{},["prevent"]))},{default:n(()=>[t(ie,{activeKey:s.value,"onUpdate:activeKey":e[10]||(e[10]=l=>s.value=l)},{default:n(()=>[t(V,{key:"userInfo",tab:"Thông tin người dùng"},{default:n(()=>[t(ae,{gutter:16},{default:n(()=>[t(te,{xs:24,md:12},{default:n(()=>[t(ee,null,{default:n(()=>[t(c,{label:"Tên người dùng"},{default:n(()=>[t(_,{value:a.value.name,"onUpdate:value":e[0]||(e[0]=l=>a.value.name=l),placeholder:"Nhập tên"},null,8,["value"])]),_:1}),t(c,{label:"Email"},{default:n(()=>[t(_,{value:a.value.email,"onUpdate:value":e[1]||(e[1]=l=>a.value.email=l),disabled:""},null,8,["value"])]),_:1}),t(c,{label:"Số điện thoại"},{default:n(()=>[t(_,{value:a.value.phone,"onUpdate:value":e[2]||(e[2]=l=>a.value.phone=l)},null,8,["value"])]),_:1}),t(c,{label:"Vai trò"},{default:n(()=>[t(_,{value:a.value.role,"onUpdate:value":e[3]||(e[3]=l=>a.value.role=l),disabled:""},null,8,["value"])]),_:1}),t(c,{label:"Trạng thái"},{default:n(()=>[a.value.status==="3"?(d(),y(x,{key:0,color:"purple"},{default:n(()=>[k(" VIP – còn "+j(N(a.value.package_end_date))+" ngày ",1)]),_:1})):a.value.status==="4"?(d(),y(x,{key:1,color:"red"},{default:n(()=>e[12]||(e[12]=[k("Hết hạn")])),_:1})):a.value.status==="1"?(d(),y(x,{key:2,color:"green"},{default:n(()=>[k(" Đang hoạt động – còn "+j(N(a.value.package_end_date))+" ngày ",1)]),_:1})):(d(),y(x,{key:3},{default:n(()=>e[13]||(e[13]=[k("Không rõ")])),_:1}))]),_:1}),t(c,null,{default:n(()=>[t(Q,{checked:v.value,"onUpdate:checked":e[4]||(e[4]=l=>v.value=l)},{default:n(()=>e[14]||(e[14]=[k("Đổi mật khẩu")])),_:1},8,["checked"])]),_:1}),v.value?(d(),y(c,{key:0,label:"Mật khẩu hiện tại"},{default:n(()=>[t(O,{value:r.current,"onUpdate:value":e[5]||(e[5]=l=>r.current=l),placeholder:"Nhập mật khẩu hiện tại"},null,8,["value"])]),_:1})):w("",!0),v.value?(d(),y(c,{key:1,label:"Mật khẩu mới"},{default:n(()=>[t(O,{value:r.new,"onUpdate:value":e[6]||(e[6]=l=>r.new=l),placeholder:"Nhập mật khẩu mới"},null,8,["value"])]),_:1})):w("",!0),v.value?(d(),y(c,{key:2,label:"Xác nhận mật khẩu mới"},{default:n(()=>[t(O,{value:r.confirm,"onUpdate:value":e[7]||(e[7]=l=>r.confirm=l),placeholder:"Nhập lại mật khẩu mới"},null,8,["value"])]),_:1})):w("",!0),t(c,{label:"Ảnh đại diện / Ảnh logo"},{default:n(()=>[B.value?(d(),y(W,{key:0,"list-type":"picture-card","file-list":h.value,"on-preview":R,"on-remove":l=>X("logo",l),"before-upload":l=>H("logo",l),"max-count":1},{default:n(()=>[h.value.length===0?(d(),b("div",Le,[t(A(_e)),e[15]||(e[15]=ge("div",{style:{"margin-top":"8px"}},"Tải ảnh",-1))])):w("",!0)]),_:1},8,["file-list","on-remove","before-upload"])):(d(),b(ye,{key:1},[a.value.avatar?(d(),b("div",Ie,[t(Y,{src:a.value.avatar,style:{width:"100px",height:"100px","object-fit":"cover"}},null,8,["src"])])):(d(),b("div",Pe,[t(Z,{size:{xs:24,sm:32,md:40,lg:64,xl:80,xxl:100},style:{"background-color":"#f5f5f5",display:"inline-flex","align-items":"center","justify-content":"center"}},{icon:n(()=>[t(A(I))]),_:1})]))],64))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(V,{key:"userSettings",tab:"Cài đặt người dùng"},{default:n(()=>[t(oe,{columns:E,"data-source":P.value,"row-key":"id",loading:S.value,pagination:!1},{bodyCell:n(({column:l,record:T})=>[l.key==="action"?(d(),y(le,{key:0},{default:n(()=>[t(L,{type:"link",onClick:se=>q(T)},{default:n(()=>e[16]||(e[16]=[k("Sửa")])),_:2},1032,["onClick"]),t(ne,{title:"Xoá cài đặt này?",onConfirm:se=>G(T.id)},{default:n(()=>[t(L,{type:"link",danger:""},{default:n(()=>e[17]||(e[17]=[k("Xoá")])),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):w("",!0)]),_:1},8,["data-source","loading"]),t(ue),t(M,{layout:"inline"},{default:n(()=>[t(c,null,{default:n(()=>[t(_,{value:p.value.key,"onUpdate:value":e[8]||(e[8]=l=>p.value.key=l),placeholder:"Key"},null,8,["value"])]),_:1}),t(c,null,{default:n(()=>[t(_,{value:p.value.value,"onUpdate:value":e[9]||(e[9]=l=>p.value.value=l),placeholder:"Value"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["activeKey"]),t(c,{style:{"margin-top":"24px"}},{default:n(()=>[t(L,{type:"primary",onClick:J},{default:n(()=>e[18]||(e[18]=[k("Lưu tất cả")])),_:1})]),_:1})]),_:1})])}}};export{Ve as default};
