import{j as D,r as f,p as G,q as J,o as O,s as Q,k as d,i as W,e as t,a as o,w as a,v as Y,b as _,c as g,l as k,h,x as Z,y as ee}from"./index-C2Vbri2L.js";const b=D.create({baseURL:"https://api-qrcode.labit365.com/api",withCredentials:!0}),te=()=>b.get("/setting"),ae=c=>b.post("/setting",c),ne=(c,y)=>b.put(`/setting/${c}`,y),le=c=>b.delete(`/setting/${c}`),ue={__name:"SettingList",setup(c){const y=f("userInfo"),L=G(),l=f({}),m=f(!1),r=J({current:"",new:"",confirm:""}),C=f([]),w=f(!1),i=f({id:null,key:"",value:""}),T=[{title:"Key",dataIndex:"key",key:"key"},{title:"Value",dataIndex:"value",key:"value"},{title:"Hành động",key:"action"}];O(async()=>{var e;const u=(e=L.user)==null?void 0:e.id;if(u){const v=await Q(u);l.value=v.data}await x()});const x=async()=>{w.value=!0;try{const u=await te();C.value=u.data}catch{d.error("Không thể tải cài đặt")}finally{w.value=!1}},V=u=>{i.value={...u}},M=async u=>{try{await le(u),d.success("Đã xoá"),x()}catch{d.error("Lỗi khi xoá")}},$=async()=>{var u,e;try{if(await Z(l.value.id,{name:l.value.name,phone:l.value.phone,status:l.value.status}),m.value){if(r.new!==r.confirm)return d.error("Mật khẩu mới không khớp");await ee({current_password:r.current,new_password:r.new}),d.success("Đã đổi mật khẩu thành công")}i.value.key&&i.value.value&&(i.value.id?(await ne(i.value.id,i.value),d.success("Đã cập nhật cài đặt")):(await ae(i.value),d.success("Đã thêm cài đặt")),i.value={id:null,key:"",value:""},await x()),d.success("Đã lưu toàn bộ thông tin")}catch(v){console.error("Lỗi khi lưu:",v),d.error(((e=(u=v==null?void 0:v.response)==null?void 0:u.data)==null?void 0:e.message)||"Lỗi khi lưu dữ liệu")}};return(u,e)=>{const v=o("a-page-header"),p=o("a-input"),s=o("a-form-item"),B=o("a-checkbox"),U=o("a-input-password"),P=o("a-image"),X=o("a-card"),j=o("a-col"),q=o("a-row"),I=o("a-tab-pane"),S=o("a-button"),A=o("a-popconfirm"),E=o("a-space"),F=o("a-table"),H=o("a-divider"),N=o("a-form"),R=o("a-tabs");return _(),W("div",null,[t(v,{title:"Thông tin người dùng & Cài đặt",class:"header-title"}),t(N,{layout:"vertical",onSubmit:e[12]||(e[12]=Y(()=>{},["prevent"]))},{default:a(()=>[t(R,{activeKey:y.value,"onUpdate:activeKey":e[11]||(e[11]=n=>y.value=n)},{default:a(()=>[t(I,{key:"userInfo",tab:"Thông tin người dùng"},{default:a(()=>[t(q,{gutter:16},{default:a(()=>[t(j,{xs:24,md:12},{default:a(()=>[t(X,null,{default:a(()=>[t(s,{label:"Tên người dùng"},{default:a(()=>[t(p,{value:l.value.name,"onUpdate:value":e[0]||(e[0]=n=>l.value.name=n),placeholder:"Nhập tên"},null,8,["value"])]),_:1}),t(s,{label:"Email"},{default:a(()=>[t(p,{value:l.value.email,"onUpdate:value":e[1]||(e[1]=n=>l.value.email=n),disabled:""},null,8,["value"])]),_:1}),t(s,{label:"Số điện thoại"},{default:a(()=>[t(p,{value:l.value.phone,"onUpdate:value":e[2]||(e[2]=n=>l.value.phone=n)},null,8,["value"])]),_:1}),t(s,{label:"Vai trò"},{default:a(()=>[t(p,{value:l.value.role,"onUpdate:value":e[3]||(e[3]=n=>l.value.role=n),disabled:""},null,8,["value"])]),_:1}),t(s,{label:"Trạng thái"},{default:a(()=>[t(p,{value:l.value.status,"onUpdate:value":e[4]||(e[4]=n=>l.value.status=n)},null,8,["value"])]),_:1}),t(s,null,{default:a(()=>[t(B,{checked:m.value,"onUpdate:checked":e[5]||(e[5]=n=>m.value=n)},{default:a(()=>e[13]||(e[13]=[h("Đổi mật khẩu")])),_:1},8,["checked"])]),_:1}),m.value?(_(),g(s,{key:0,label:"Mật khẩu hiện tại"},{default:a(()=>[t(U,{value:r.current,"onUpdate:value":e[6]||(e[6]=n=>r.current=n),placeholder:"Nhập mật khẩu hiện tại"},null,8,["value"])]),_:1})):k("",!0),m.value?(_(),g(s,{key:1,label:"Mật khẩu mới"},{default:a(()=>[t(U,{value:r.new,"onUpdate:value":e[7]||(e[7]=n=>r.new=n),placeholder:"Nhập mật khẩu mới"},null,8,["value"])]),_:1})):k("",!0),m.value?(_(),g(s,{key:2,label:"Xác nhận mật khẩu mới"},{default:a(()=>[t(U,{value:r.confirm,"onUpdate:value":e[8]||(e[8]=n=>r.confirm=n),placeholder:"Nhập lại mật khẩu mới"},null,8,["value"])]),_:1})):k("",!0),t(s,{label:"Ảnh đại diện"},{default:a(()=>[l.value.avatar?(_(),g(P,{key:0,src:l.value.avatar,style:{width:"100px",height:"100px","object-fit":"cover"}},null,8,["src"])):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(I,{key:"userSettings",tab:"Cài đặt người dùng"},{default:a(()=>[t(F,{columns:T,"data-source":C.value,"row-key":"id",loading:w.value,pagination:!1},{bodyCell:a(({column:n,record:K})=>[n.key==="action"?(_(),g(E,{key:0},{default:a(()=>[t(S,{type:"link",onClick:z=>V(K)},{default:a(()=>e[14]||(e[14]=[h("Sửa")])),_:2},1032,["onClick"]),t(A,{title:"Xoá cài đặt này?",onConfirm:z=>M(K.id)},{default:a(()=>[t(S,{type:"link",danger:""},{default:a(()=>e[15]||(e[15]=[h("Xoá")])),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):k("",!0)]),_:1},8,["data-source","loading"]),t(H),t(N,{layout:"inline"},{default:a(()=>[t(s,null,{default:a(()=>[t(p,{value:i.value.key,"onUpdate:value":e[9]||(e[9]=n=>i.value.key=n),placeholder:"Key"},null,8,["value"])]),_:1}),t(s,null,{default:a(()=>[t(p,{value:i.value.value,"onUpdate:value":e[10]||(e[10]=n=>i.value.value=n),placeholder:"Value"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["activeKey"]),t(s,{style:{"margin-top":"24px"}},{default:a(()=>[t(S,{type:"primary",onClick:$},{default:a(()=>e[16]||(e[16]=[h("Lưu tất cả")])),_:1})]),_:1})]),_:1})])}}};export{ue as default};
